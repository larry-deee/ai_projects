# Anthropic Native Pass-Through Performance Configuration
# =======================================================
# 
# This file contains optimized performance settings for the Anthropic native
# adapter. Adjust these values based on your deployment environment and load
# requirements.

# Basic Anthropic API Configuration
ANTHROPIC_API_KEY=your-anthropic-api-key
ANTHROPIC_BASE_URL=https://api.anthropic.com
ANTHROPIC_VERSION=2023-06-01

# Connection Pool Optimization
# Maximum number of concurrent connections to Anthropic API
ANTHROPIC_MAX_CONNECTIONS=200

# Maximum number of keep-alive connections to reuse
ANTHROPIC_MAX_KEEPALIVE=100

# Keep-alive connection expiry time in seconds
ANTHROPIC_KEEPALIVE_EXPIRY=30.0

# Request Timeout Configuration
# Main request timeout in seconds (set high for long-running requests)
ANTHROPIC_TIMEOUT=60.0

# SSE Streaming Optimization
# Chunk size in bytes for streaming responses (8KB is optimal for most cases)
ANTHROPIC_CHUNK_SIZE=8192

# Performance Thresholds for Monitoring
# Maximum acceptable latency for P95 requests in milliseconds
PERFORMANCE_LATENCY_P95_THRESHOLD_MS=500

# Maximum acceptable memory usage increase per concurrent stream in MB
PERFORMANCE_MEMORY_PER_STREAM_THRESHOLD_MB=1

# Minimum acceptable connection reuse rate percentage
PERFORMANCE_CONNECTION_REUSE_THRESHOLD=80

# Router Performance Configuration
# Number of async worker threads for handling requests
ROUTER_THREAD_POOL_SIZE=4

# Enable/disable thread-local event loop caching (recommended: true)
ROUTER_ENABLE_LOOP_CACHING=true

# Deployment Environment Optimization
# Set to 'production', 'development', or 'testing'
DEPLOYMENT_ENV=production

# Production Optimizations (when DEPLOYMENT_ENV=production)
# Disable debug logging for better performance
PRODUCTION_LOG_LEVEL=WARNING

# Enable HTTP/2 for better multiplexing (recommended: true)
PRODUCTION_ENABLE_HTTP2=true

# Enable connection warmup on startup (recommended: true)  
PRODUCTION_WARMUP_CONNECTIONS=true

# Development/Testing Optimizations (when DEPLOYMENT_ENV=development)
# Enable verbose logging for debugging
DEV_LOG_LEVEL=DEBUG

# Reduced connection limits for local testing
DEV_MAX_CONNECTIONS=50
DEV_MAX_KEEPALIVE=20

# Load Testing Configuration
# Settings for performance benchmarking
BENCHMARK_BASE_URL=http://localhost:8000
BENCHMARK_CONCURRENT_WORKERS=10
BENCHMARK_REQUESTS_PER_WORKER=20
BENCHMARK_STREAMING_DURATION_SECONDS=30

# Monitoring and Alerting
# Enable performance metrics endpoint (recommended: true)
ENABLE_METRICS_ENDPOINT=true

# Performance metrics collection interval in seconds
METRICS_COLLECTION_INTERVAL=30

# Enable connection health monitoring (recommended: true)
ENABLE_CONNECTION_MONITORING=true

# Memory Usage Optimization
# Enable garbage collection optimization for streaming
ENABLE_GC_OPTIMIZATION=true

# Set garbage collection threshold for memory management
GC_THRESHOLD_MB=100

# Advanced Configuration
# Enable request deduplication for identical concurrent requests
ENABLE_REQUEST_DEDUPLICATION=false

# Enable response caching for short-lived responses (not recommended for streaming)
ENABLE_RESPONSE_CACHING=false

# Circuit breaker configuration for handling upstream failures
CIRCUIT_BREAKER_FAILURE_THRESHOLD=5
CIRCUIT_BREAKER_RESET_TIMEOUT_SECONDS=60

# Rate limiting configuration to prevent overwhelming upstream
RATE_LIMIT_REQUESTS_PER_SECOND=100
RATE_LIMIT_BURST_SIZE=200

# Notes:
# - Adjust ANTHROPIC_MAX_CONNECTIONS based on your expected concurrent load
# - Lower ANTHROPIC_KEEPALIVE_EXPIRY if you have intermittent traffic patterns
# - Increase ANTHROPIC_CHUNK_SIZE for high-throughput scenarios (up to 64KB)
# - Monitor connection reuse rates - should be >80% under normal load
# - Set ROUTER_THREAD_POOL_SIZE to match your server's CPU core count
# - Enable all production optimizations in production deployments